{#include base}
    <div id="dashboard"
         class="fullscreen"
         hx-ext="sse"
         sse-connect="/command/feedback">

        <div id="top-bar"
             style="background: var(--almost-night)">
            <label class="top-bar-title title-font big padding-inline">reactive-todos</label>
            <chip id="sse-connection-chip"
                  class="top-bar-connection mono-font warn"
                  style="border-radius: unset;"
                  _="on htmx:sseOpen from document
                                remove .warn from me
                                then add .ok to me
                                then put 'CONN' into me
                             on htmx:sseError from document
                                remove .ok from me
                                then add .warn to me
                                then put 'DOWN' into me
                            ">
                DOWN
            </chip>
            <label class="top-bar-version">
                v{applicationVersion ?: 'unknown'}
            </label>
        </div>

        <div id="content">
            <div id="todo-grid"
                 class="todo-grid"
                 sse-swap="todo.created,todo.updated"
                 hx-swap="beforeend">
            </div>
            <div id="feedback"
                 sse-swap="help,empty,internal_error"
                 hx-swap="innerHTML">
            </div>
        </div>

        <div id="bottom-bar"
             style="background: var(--night)">
            <div class="bar-element-arrow-right float:left">
                <label class="padding-inline"
                       style="background: var(--almost-night); color: var(--fg)">
                    COMMAND
                </label>
                <div style="color: var(--almost-night)"></div>
            </div>
            <div class="bar-element-arrow-left float:right">
                <div style="color: var(--almost-night)"></div>
                <label class="with-icon padding-inline info fg"
                       style="background: var(--almost-night)"
                       _="init
                        repeat forever
                            js
                                return new Date().toLocaleString('ru-RU', {
                                    timeStyle: 'short',
                                    dateStyle: 'short'
                                });
                            end
                            then put it into my.innerHTML
                            wait 60s
                    "
                >
                    <i class="nf-md-calendar_clock"></i>
                </label>
            </div>
        </div>

        <div id="command-line"
             class="command-line">
            <label class="command-prompt" for="command">:</label>
            <input class="command-input" id="command"
                   name="command"
                   type="search"
                   hx-post="/command/execute"
                   hx-trigger="keyup[key=='Enter']"
                   hx-target="#feedback"
                   hx-target-error="#feedback"
                   _="on keyup[key!=='Enter']
                            debounced at 500ms
                            fetch /command/analyze
                                with
                                    body: my value,
                                    method: 'POST'">
        </div>
    </div>
{/include}